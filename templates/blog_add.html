{% extends "base.html" %}
{% block header %}
    {% set active_page = "blog" %}
    {% include "header.html" %}
{% endblock %}
{% block css %}
    <link href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-markdown/2.7.0/css/bootstrap-markdown.min.css" rel="stylesheet">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://timschlechter.github.io/bootstrap-tagsinput/examples/lib/bootstrap-tagsinput/bootstrap-tagsinput.css">
{% endblock %}
{% block scripts %}
    <script src="https://toopay.github.io/bootstrap-markdown/js/to-markdown.js"></script>
    <script src="https://toopay.github.io/bootstrap-markdown/js/markdown.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-markdown/2.7.0/js/bootstrap-markdown.min.js"></script>
{% endblock %}
{% block body %}
    <form class="form" method="POST" id="add-post" role="form">
        {{ form.hidden_tag() }}

        <div class="form-group">
            <label>Заголовок* </label>
            {{ form.topic(class_='form-control', placeholder='Топік') }}
        </div>

        <div class="form-group">
            <label>Текст* </label>
            {{ form.content(placeholder='Багато букафф') }}
        </div>

        <div class="form-group">
            <div class="md-preview"></div>
        <div>

        <div class="form-group">
            <label>Теги*</label><br/>
            {{ form.tags(class_='form-control', placeholder='сюди введіть теги', **{'data-role':'tagsinput'}) }}
        </div>

        <script>
            $("textarea#content").markdown({
                resize:'vertical',
                iconlibrary:'fa',
                hiddenButtons: ['Preview', 'Code'],
                onShow: function(e){
                    $(".md-preview").html(e.parseContent())
                },
                onChange: function(e) {
                    $(".md-preview").html(e.parseContent())
                }})
        </script>

        <button type="submit" id="submit-button" class="btn btn-primary">Відновити</button>

        <div id="message"></div>
        <div id="status"></div>
    </form>

    <script>
        // TODO: Refactor this and a function in books_add.html
        $(function() {
            $("#submit-button").click(function(e) {
                e.preventDefault();
                $.ajax({
                    url: "/blog/add/submit",
                    type: 'POST',
                    data: $("#add-post").serialize(),
                    beforeSend: function() {
                        $("#message").html("sending...");
                    },
                    success: function(data) {
                        var json_data = jQuery.parseJSON(data);
                        if (json_data["type"] == "error") {
                            $("#message").hide();
                            $("#status").addClass("bg-danger");
                            $("#status").html(json_data["message"]);
                        }
                        else {
                            window.location.replace("/blog");
                        }
                    }
                });
            });
        });
    </script>

    * Обов’язкові поля
    <script src="https://timschlechter.github.io/bootstrap-tagsinput/examples/lib/bootstrap-tagsinput/bootstrap-tagsinput.js"></script>
{% endblock %}
