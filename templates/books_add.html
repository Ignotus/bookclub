{# home.html #}
{% extends "base.html" %}
{% block body %}
{% set active_page = "books" %}
{% include "header.html" %}
<div class="container">
    <div class="main">
        <form class="form" method="POST" id="add-book" role="form">
            {{ form.hidden_tag() }}

            <div class="form-group">
                <label>Автор книги</label>
                {{ form.author(class_='form-control', placeholder='Автор книги') }}
            </div>
            <div class="form-group">
                <label>Назва книги</label>
                {{ form.name(class_='form-control', placeholder='Назва книги') }}
            </div>

            <div class="form-group">
                <label>URL на картинку для залучення уваги :)</label>
                {{ form.img(class_='form-control', placeholder='URL на картинку для залучення уваги :)') }}
            </div>

            <div class="form-group">
                <label>URL на додаткову інформацію</label>
                {{ form.url(class_='form-control', placeholder='URL на додаткову інформацію') }}
            </div>

            <div class="form-group">
                <label>Опис книги</label>
                {{ form.description(class_='form-control', placeholder='Опис книги') }}
            </div>

            <button type="submit" id="submit-button" class="btn btn-default">{% if book_data is defined %}Відновити{% else %}Додати{% endif %}</button>

            <div id="message"></div>
            <div id="status"></div>
        </form>

        <script>
              $(function() {
                $("#submit-button").click(function(e) {
                  e.preventDefault();
                  $.ajax({
                    url: "/books/update",
                    type: 'POST',
                    data: $("#add-book").serialize(),
                    beforeSend: function() {
                      $("#message").html("sending...");
                    },
                    success: function(data) {
                      var json_data = jQuery.parseJSON(data);
                      if (json_data["type"] == "error") {
                        $("#message").hide();
                        $("#status").addClass("bg-danger");
                        $("#status").html(json_data["message"]);
                      }
                      else {
                        window.location.replace("/books");
                      }
                    }
                  });
                });
              });
        </script>
    </div>
</div>
{% endblock %}